\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[serbian]{babel}
\usepackage{amsmath, amssymb}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{float}
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{siunitx} 
\sisetup{group-separator = {\,}, group-minimum-digits = 4} 


\title{Višestruka regresija za predikciju cijene automobila u Srbiji}
\author{Teodor Vidaković}
\date{Jul 2025}

\begin{document}
\maketitle

\section{Eksplorativna analiza podataka}

Dataset sadrži informacije o oglasima polovnih automobila u Srbiji. Skup podataka ima ukupno 1756 primjera i 10 kolona, pri čemu ne postoje nedostajuće vrednosti. Korišćene kolone uključuju: \texttt{Marka}, \texttt{Grad}, \texttt{Godina proizvodnje}, \texttt{Karoserija}, \texttt{Gorivo}, \texttt{Zapremina motora}, \texttt{Kilometraža}, \texttt{Konjske snage}, \texttt{Menjač} i ciljnu promenljivu \texttt{Cena}.

\subsection{Osnovne statistike}

Nakon uklanjanja duplikata, ostaje 1353 validnih zapisa. Osnovne statistike za numeričke promjenljive prikazane su u Tabeli 1.

\begin{table}[H]
\centering
\caption{Osnovne statistike numeričkih promenljivih}
\label{tab:statistika}
\begin{tabularx}{\textwidth}{l *{6}{>{\raggedleft\arraybackslash}X}}
\toprule
\textbf{Atribut} & \textbf{Min} & \textbf{(25\%)} & \textbf{(50\%)} & \textbf{(75\%)} & \textbf{Max} & \textbf{Srednja} \\
\midrule
Cijena [EUR] & \num{1000} & \num{3000} & \num{5900} & \num{13500} & \num{999000} & \num{45027} \\
Godina proizvodnje & 1894 & 2006 & 2010 & 2015 & 2025 & 2010 \\
Zapremina motora [cm$^3$] & \num{163} & \num{1398} & \num{1600} & \num{1984} & \num{5461} & \num{1742.6} \\
Kilometraža [km] & \num{1000} & \num{165563} & \num{209000} & \num{256000} & \num{552000} & \num{206512} \\
Konjske snage & \num{45} & \num{92} & \num{116} & \num{150} & \num{620} & \num{129.5} \\
\bottomrule
\end{tabularx}
\end{table}

Vidimo da su cijene veoma varijabilne, pri čemu se maksimalna cijena kreće i do 999\,000 EUR, što ukazuje na prisustvo outlier-a. Većina automobila ima pređeno između 150\,000 i 300\,000 kilometara.

\subsection{Vizuelizacije}

U cilju grafičke analize podataka, korišćeni su sledeći prikazi:

\begin{itemize}
    \item \textbf{Histogram distribucije cijena} (Slika~\ref{fig:hist_cena})
    \item \textbf{Boxplot cijena} (Slika~\ref{fig:box_cena})
    \item \textbf{Korelaciona matrica numeričkih promenljivih} (Slika~\ref{fig:corr_matrix})
    \item \textbf{Scatterplot: Cijena vs. Starost vozila} (Slika~\ref{fig:starost_vs_cena})
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{hist_cena.png}
    \caption{Distribucija cijena automobila}
    \label{fig:hist_cena}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{box_cena.png}
    \caption{Boxplot cijena automobila}
    \label{fig:box_cena}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\textwidth]{corr_matrix.png}
    \caption{Korelaciona matrica numeričkih atributa}
    \label{fig:corr_matrix}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{scatter_starost_vs_cena.png}
    \caption{Raspodjela cijene u odnosu na starost vozila}
    \label{fig:starost_vs_cena}
\end{figure}

\subsection{Uočeni obrasci i anomalije}

Na osnovu vizuelne analize identifikovani su sledeći obrasci:

\begin{itemize}
    \item \textbf{Distribucija cijena je snažno asimetrična} (Slika~\ref{fig:hist_cena}) – većina vozila se prodaje ispod 20\,000 EUR, dok manji broj primjera sa cijenama od 100\,000+ EUR značajno odskače.
    
    \item \textbf{Prisustvo outlier-a potvrđeno je boxplot-om} (Slika~\ref{fig:box_cena}) – postoje brojni ekstremi koji narušavaju raspodjelu ciljne promjenljive i negativno utiču na RMSE.

    \item \textbf{Starost vozila i cijena imaju blago pozitivnu korelaciju} ($r = 0.18$), što je neočekivano. Međutim, scatterplot (Slika~\ref{fig:starost_vs_cena}) pokazuje da najskuplji automobili nisu novi, već stari — vjerovatno luksuzni, sportski ili kolekcionarski modeli. Većina novijih automobila (0–5 godina starosti) ima prosječnu ili nisku cenu, dok ekstremno visoke vrednosti dolaze od nekoliko skupocjenih vozila koja su stara 10+ godina. Ova nelinearna struktura dovodi do “lažne” pozitivne korelacije u linearnom smislu, iako bi se očekivala negativna veza između cijene i starosti.

    \item \textbf{Kilometraža ima vrlo slab odnos sa cijenom} ($r = 0.03$) – korisnici očigledno ne rangiraju ovaj faktor visoko pri određivanju cene.

    \item \textbf{Konjske snage i zapremina motora su visoko korelisani} ($r = 0.82$, Slika~\ref{fig:corr_matrix}) – što je i očekivano s obzirom na tehničku povezanost tih karakteristika.

    \item \textbf{Kategorijske promenljive su raznovrsne i zahtevaju kodiranje}:
    \begin{itemize}
        \item Marka: 44 vrednosti
        \item Grad: 236 različitih mesta (visoka disperzija)
        \item Karoserija i Gorivo: po 8 klasa
        \item Menjač: 2 klase (Manuelni i Automatski)
    \end{itemize}
\end{itemize}

\section{Preprocesiranje podataka}

Pre nego što je model treniran, podaci su prošli kroz preprocesiranje sa ciljem da se obezbjedi robusnost modela i smanji uticaj ekstremnih vrednosti.

\begin{itemize}
    \item \textbf{Filtriranje cijena} – Na osnovu prethodne analize, identifikovani su automobili sa ekstremno visokim cijenama (iznad 100\,000 EUR), koji značajno narušavaju distribuciju ciljne promenljive i utiču na RMSE. Umesto kvantilnog filtra, primenjena je jednostavna prag-filtracija: u dalji rad uključeni su samo primeri sa cijenom manjom ili jednakom \textbf{50\,000 EUR}. Time je uklonjen uticaj luksuznih i atipičnih vozila.

    \item \textbf{Uklanjanje duplikata} – Prije treniranja modela, duplirani oglasi su uklonjeni pomoću \texttt{drop\_duplicates()} metode.

    \item \textbf{Inženjering osobina} – Iz atributa \texttt{Godina proizvodnje} kreirana je nova numerička promjenljiva \texttt{Starost}, izračunata kao $2025 - \text{Godina proizvodnje}$. Ova osobina bolje opisuje uticaj vremena na gubitak vrijednosti vozila i zamjenjuje sirovu godinu.

    \item \textbf{Obrada numeričkih podataka} – Odabrane numeričke promjenljive su:
    \begin{itemize}
        \item \texttt{Starost}
        \item \texttt{Zapremina motora}
        \item \texttt{Kilometraža}
        \item \texttt{Konjske snage}
    \end{itemize}
    Kako bi model mogao da uoči nelinearne zavisnosti, na njih je primjenjena polinomska transformacija drugog stepena. Nakon toga, sve numeričke osobine su standardizovane (\texttt{StandardScaler}), što znači da je na njih primenjena z-score transformacija.

    \item \textbf{Obrada kategoričkih podataka} – Sledeće kolone su tretirane kao kategoričke:
    \begin{itemize}
        \item \texttt{Marka}, \texttt{Grad}, \texttt{Karoserija}, \texttt{Gorivo}, \texttt{Menjač}
    \end{itemize}
    Svaka od njih je kodirana tehnikom \textbf{One-Hot Encoding} kako bi se izbjegle greške pri predikciji na test skupu.

    \item \textbf{Log-transformacija ciljne promenljive} – Cijena automobila, kao ciljna promjenljiva, ima izraženu asimetričnu raspodjelu sa teškim desnim repom. Da bi se smanjio uticaj outlier-a i poboljšala stabilnost modela, izvršena je log-transformacija putem funkcije $\log(1 + y)$ pomoću \texttt{FunctionTransformer}. Predikcije su potom inverzno transformisane pomoću $\exp(y) - 1$.
	\begin{figure}[H]
	    \centering
	    \includegraphics[width=\textwidth]{log_transformacija_cena.png}
	    \caption{Distribucija ciljne promenljive prije i poslije log-transformacije}
	    \label{fig:log_transform}
	\end{figure}
\end{itemize}

Nakon svih koraka, numeričke i kategoričke komponente objedinjene su pomoću \texttt{ColumnTransformer}. Transformacija ciljne promjenljive vršena je korišćenjem \texttt{TransformedTargetRegressor}, čime se obezbjeđuje konzistentna transformacija pri treniranju i predikciji.

\section{Podela skupa podataka}

Za treniranje i evaluaciju modela korišćena su dva režima podele podataka, u zavisnosti od konteksta pokretanja:

\begin{itemize}
    \item \textbf{Lokalna podela podataka (offline evaluacija):} Kada se pokreće lokalno (npr. tokom eksperimentisanja), koristi se samo jedan skup podataka. U tom slučaju, podaci se dele na trening i test skup pomoću funkcije \texttt{train\_test\_split} u odnosu 80:20. Da bi se očuvala reprezentativna distribucija ciljne promenljive, koristi se stratifikacija po cenovnim opsezima — konkretno, \texttt{Cena} se podeli na 5 kvantila pomoću \texttt{qcut}, a rezultat se koristi kao stratifikacioni ključ.

    \item \textbf{Eksplicitna podela putem komandne linije:} Kada se skripta pokreće sa dva ulazna fajla (npr. \texttt{python model.py train.tsv test.tsv}), koristi se unapred pripremljeni trening i test skup — bez dodatne podele unutar skripte. Ova varijanta se koristi za finalnu evaluaciju modela na test skupu koji nije korišćen u fazi treniranja.
\end{itemize}

Nakon što je trening skup definisan, primenjena je \textbf{K-Fold unakrsna validacija} (\texttt{KFold}) sa brojem preklopa $k = 5$, uz opciju \texttt{shuffle=True} i fiksiran \texttt{random\_state=42} radi reproduktivnosti. Ova validacija ima dvostruku ulogu:

\begin{itemize}
    \item Unutar Lasso modela (\texttt{LassoCV}) koristi se za automatsku selekciju optimalnog hiperparametra $\alpha$.
    \item Paralelno se koristi za procenu performansi modela korišćenjem metrike RMSE, preko funkcije \texttt{cross\_val\_score}.
\end{itemize}

Ovaj pristup omogućava robusnu procenu generalizacione sposobnosti modela bez curenja podataka iz test skupa. Nakon toga, model se trenira na celom trening skupu i koristi za evaluaciju na izdvojenom test skupu.

\section{Isprobani algoritmi}

Korišćen je \texttt{LassoCV} iz \texttt{scikit-learn}, zbog sposobnosti automatske selekcije osobina i regularizacije.

\subsection{Podešavanje hiperparametara}

\texttt{LassoCV} automatski bira vrednost regularizacionog parametra $\alpha$ testiranjem više vrednosti (logspace između $10^{-4}$ i $10^2$). Najbolja vrednost $\alpha$ pronađena je unutar svakog CV fold-a.

\subsection{Rezultati}

Na 5-fold cross-validaciji sa $q=0.90$, postignut je sledeći rezultat:
\[
\text{RMSE (log-transformisan target)} = \textbf{6361.27 ± 312.45 EUR}
\]

što je ispod zadatog praga od 6500 EUR.

\section{Odabrano rešenje}

Finalno rešenje koristi sledeće komponente:
\begin{itemize}
    \item Preprocesiranje: polinomske osobine + standardizacija + one-hot encoding
    \item Regresor: \texttt{LassoCV} sa automatskom selekcijom $\alpha$
    \item Transformacija ciljne promenljive: $\log(1 + y)$
\end{itemize}

Ova konfiguracija pokazala se kao najefikasnija u smislu balansa kompleksnosti i performansi, omogućavajući robusnu generalizaciju uz ispunjavanje uslova zadatka.

\section*{Reference}

\begin{itemize}
    \item Pedregosa et al., \textit{Scikit-learn: Machine Learning in Python}, JMLR 2011.
    \item zvanična dokumentacija: \url{https://scikit-learn.org/stable/}
    \item Dataset: Oglasi automobila u Srbiji (projekat FTN, 2025)
\end{itemize}

\end{document}
